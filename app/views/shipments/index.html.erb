<% content_for :subheader_title do %>
Envios
<% end %>

<div class="row">
  <div class="col-lg-12">
    <div class="kt-portlet">
      <div class="kt-portlet__head">
        <div class="kt-portlet__head-label">
          <h3 class="kt-portlet__head-title">
            Envios recentes
          </h3>
        </div>
        <div class="kt-portlet__head-toolbar">
          <div class="kt-portlet__head-wrapper">
            <div class="btn-group">
              <%= link_to new_shipment_path, class: "btn btn-primary" do %>
              <i class="la la-plus"></i>
              Novo envio
              <% end %>
							<button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							</button>
							<div class="dropdown-menu dropdown-menu-right">
                <h6 class="dropdown-header">Criar a partir de uma nota fiscal</h6>
                <%= form_for :invoice_xml, url: new_from_xml_shipments_path, html: {class: 'd-none'} do |f| %>
                  <%= f.file_field :invoice_xml, id:"fileinput" %><br><br>
                  <%= f.submit 'Enviar' %>
                <% end  %>
                <div class="px-4 py-3">
                  <button type="submit" id="filebutton" class="btn btn-primary btn-sm btn-upper">Selecionar Arquivo</button>
                </div>
							</div>
						</div>
          </div>
        </div>
      </div>
      <div class="kt-portlet__body">
        <div class="kt-portlet__content">
          <table class="table table-hover table-head-noborder">
            <thead>
              <tr>
                <th>#</th>
                <th>Nome</th>
                <th>Cidade</th>
                <th>Enviado em</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% @shipments.each do |shipment| %>
              <tr>
                  <td><%= link_to shipment.shipment_number, shipment, class: "kt-link" %></td>
                  <td><%= shipment.recipient_full_name %></td>
                  <td><%= shipment.recipient_city %></td>
                  <td><%= shipment.shipped_at.try(:to_date) %></td>
                  <td><%= shipment.status %></td>
              </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
$('#filebutton').click(function(e){
  e.preventDefault();
  $('#fileinput').click();
});
$('#fileinput').change(function(){
  $(this).parent('form').submit();
});
</script>
